(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))r(e);new MutationObserver(e=>{for(const i of e)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function a(e){const i={};return e.integrity&&(i.integrity=e.integrity),e.referrerPolicy&&(i.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?i.credentials="include":e.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(e){if(e.ep)return;e.ep=!0;const i=a(e);fetch(e.href,i)}})();const u={Fajr:"Ø§Ù„ÙØ¬Ø±",Sunrise:"Ø§Ù„Ø´Ø±ÙˆÙ‚",Dhuhr:"Ø§Ù„Ø¸Ù‡Ø±",Asr:"Ø§Ù„Ø¹ØµØ±",Maghrib:"Ø§Ù„Ù…ØºØ±Ø¨",Isha:"Ø§Ù„Ø¹Ø´Ø§Ø¡"},P=["Fajr","Dhuhr","Asr","Maghrib","Isha"],q={Fajr:"ğŸŒ™",Sunrise:"â˜€ï¸",Dhuhr:"â˜€ï¸",Asr:"ğŸŒ¤ï¸",Maghrib:"ğŸŒ™",Isha:"ğŸŒ™"},x={Jeddah:{city:"Jeddah",country:"Saudi Arabia",method:4},Makkah:{city:"Makkah",country:"Saudi Arabia",method:4},Riyadh:{city:"Riyadh",country:"Saudi Arabia",method:4},Madinah:{city:"Medina",country:"Saudi Arabia",method:4},Dammam:{city:"Dammam",country:"Saudi Arabia",method:4},Cairo:{city:"Cairo",country:"Egypt",method:5},Dubai:{city:"Dubai",country:"United Arab Emirates",method:3},"Kuwait City":{city:"Kuwait City",country:"Kuwait",method:4},Amman:{city:"Amman",country:"Jordan",method:3},Beirut:{city:"Beirut",country:"Lebanon",method:3},Baghdad:{city:"Baghdad",country:"Iraq",method:3},London:{city:"London",country:"United Kingdom",method:2},"New York":{city:"New York",country:"USA",method:2},Paris:{city:"Paris",country:"France",method:12},Istanbul:{city:"Istanbul",country:"Turkey",method:13},Tokyo:{city:"Tokyo",country:"Japan",method:3}},t={syncStatusBar:document.getElementById("syncStatusBar"),syncStatus:document.getElementById("syncStatus"),lastSync:document.getElementById("lastSync"),syncBtn:document.getElementById("syncBtn"),settingsBtn:document.getElementById("settingsBtn"),currentTime:document.getElementById("currentTime"),currentDate:document.getElementById("currentDate"),countdownCard:document.getElementById("countdownCard"),countdownPrayer:document.getElementById("countdownPrayer"),countdownCircle:document.getElementById("countdownCircle"),countdownTime:document.getElementById("countdownTime"),adhanTime:document.getElementById("adhanTime"),iqamaTime:document.getElementById("iqamaTime"),nextPrayerCard:document.getElementById("nextPrayerCard"),currentCity:document.getElementById("currentCity"),nextPrayerName:document.getElementById("nextPrayerName"),nextPrayerTime:document.getElementById("nextPrayerTime"),hoursUntil:document.getElementById("hoursUntil"),minutesUntil:document.getElementById("minutesUntil"),prayersTitle:document.getElementById("prayersTitle"),prayersList:document.getElementById("prayersList"),settingsModal:document.getElementById("settingsModal"),closeSettingsBtn:document.getElementById("closeSettingsBtn"),saveSettingsBtn:document.getElementById("saveSettingsBtn"),citySelect:document.getElementById("citySelect"),durationInputs:{Fajr:document.getElementById("fajrDuration"),Dhuhr:document.getElementById("dhuhrDuration"),Asr:document.getElementById("asrDuration"),Maghrib:document.getElementById("maghribDuration"),Isha:document.getElementById("ishaDuration")}};let y=null,l=null,s={city:"Jeddah",iqamahDurations:{Fajr:25,Dhuhr:20,Asr:20,Maghrib:10,Isha:20}},f=new Set;function I(n){return n.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}function E(n){if(!n)return null;const o={};for(const a in n){if(!u[a])continue;const r=new Date(n[a]);isNaN(r.getTime())||(o[a]={time:r,formatted:I(r)})}return o}function p(n=null){if(!l)return;t.prayersList.innerHTML="",["Fajr","Sunrise","Dhuhr","Asr","Maghrib","Isha"].forEach(a=>{const r=l[a];if(!r)return;const e=s.iqamahDurations[a]||0,i=new Date(r.time.getTime()+e*60*1e3),c=document.createElement("div");c.className=`prayer-item ${a===n?"active":""}`,c.innerHTML=`
            <div class="prayer-icon">${q[a]||"ğŸ•Œ"}</div>
            <div class="prayer-info">
                <div class="prayer-item-name">${u[a]}</div>
                <div class="prayer-times">
                    <span>Ø§Ù„Ø£Ø°Ø§Ù†: ${r.formatted}</span>
                    ${P.includes(a)?`<span>Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©: ${I(i)}</span>`:"<span>&nbsp;</span>"}
                </div>
            </div>
        `,t.prayersList.appendChild(c)})}function O(n){t.currentTime.textContent=n.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",second:"2-digit",hour12:!0}),t.currentDate.textContent=n.toLocaleDateString("ar-SA-u-nu-latn",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}function k(n){t.countdownCard.style.display="none",t.nextPrayerCard.style.display="block";const o=new Date,a=n.time.getTime()-o.getTime(),r=Math.floor(a/(1e3*60*60)),e=Math.floor(a%(1e3*60*60)/(1e3*60));t.nextPrayerName.textContent=u[n.name],t.nextPrayerTime.textContent=n.formatted,t.hoursUntil.textContent=String(r).padStart(2,"0"),t.minutesUntil.textContent=String(e).padStart(2,"0")}function j(n,o){t.nextPrayerCard.style.display="none",t.countdownCard.style.display="block";const a=(s.iqamahDurations[n.name]||0)*60,r=new Date(n.time.getTime()+a*1e3),e=Math.max(0,Math.round((r.getTime()-o.getTime())/1e3)),i=Math.floor(e/60),c=e%60,d=t.countdownCircle.r.baseVal.value,g=2*Math.PI*d;t.countdownCircle.style.strokeDasharray=String(g);const D=(a-e)/a,w=g*(1-D);t.countdownPrayer.textContent=u[n.name],t.countdownTime.textContent=`${String(i).padStart(2,"0")}:${String(c).padStart(2,"0")}`,t.adhanTime.textContent=n.formatted,t.iqamaTime.textContent=I(r),t.countdownCircle.style.strokeDashoffset=String(w);const T=`${n.name}-${n.time.toISOString()}`;e===60&&!f.has(`${T}-pre`)&&(b(`Ø§Ù‚ØªØ±Ø¨Øª Ø¥Ù‚Ø§Ù…Ø© ØµÙ„Ø§Ø© ${u[n.name]}`,"ÙŠØªØ¨Ù‚Ù‰ Ø¯Ù‚ÙŠÙ‚Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©."),f.add(`${T}-pre`))}function S(){const n=new Date;if(O(n),!l)return;let o=null,a=null;const r=Object.entries(l).filter(([e,i])=>P.includes(e)&&i&&typeof i=="object").map(([e,i])=>({name:e,...i})).sort((e,i)=>e.time.getTime()-i.time.getTime());for(const e of r){e.time>n&&!o&&(o=e);const i=new Date(e.time.getTime()+(s.iqamahDurations[e.name]||0)*60*1e3);n>=e.time&&n<i&&(a=e)}if(!o&&r.length>0){const e=new Date(r[0].time);e.setDate(e.getDate()+1),o={name:r[0].name,time:e,formatted:r[0].formatted}}if(a){j(a,n),p(a.name);const e=`${a.name}-${a.time.toISOString()}`,i=new Date(a.time.getTime()+(s.iqamahDurations[a.name]||0)*60*1e3);n>=i&&!f.has(`${e}-post`)&&(b("Ø­Ø§Ù† ÙˆÙ‚Øª Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©!",`Ù‚Ø§Ù…Øª ØµÙ„Ø§Ø© ${u[a.name]}`),f.add(`${e}-post`))}else o&&(k(o),p())}async function C(){t.syncStatusBar.classList.add("syncing");const n=t.citySelect.options[t.citySelect.selectedIndex].text;t.syncStatus.innerHTML=`<div class="loading-spinner"></div> <span>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ù„Ù…Ø¯ÙŠÙ†Ø© ${n}...</span>`,t.syncBtn.disabled=!0;try{const o=s.city,a=x[o];if(!a)throw new Error("City not found");const r=new Date,e=new URLSearchParams({city:a.city,country:a.country,method:a.method.toString()}),i=`https://api.aladhan.com/v1/timingsByCity/${r.getDate()}-${r.getMonth()+1}-${r.getFullYear()}?${e.toString()}`,c=await fetch(i);if(!c.ok)throw new Error(`API fetch failed with status ${c.status}`);const d=await c.json();if(d.code!==200||!d.data||!d.data.timings)throw new Error("Invalid API response format");const g={},D=d.data.date.gregorian.date.split("-").reverse().join("-"),w=d.data.meta.timezone,v=new Intl.DateTimeFormat("en-US",{timeZone:w,timeZoneName:"longOffset"}).formatToParts(new Date).find(m=>m.type==="timeZoneName");let B="+00:00";if(v){const m=v.value.replace("GMT","");if(m==="")B="+00:00";else{const[h,$="0"]=m.split(":"),A=h.includes("-")?"-":"+",L=parseInt(h.replace(/[-+]/,""),10),N=parseInt($,10);!isNaN(L)&&!isNaN(N)&&(B=`${A}${String(L).padStart(2,"0")}:${String(N).padStart(2,"0")}`)}}for(const m of Object.keys(u))if(d.data.timings[m]){const h=d.data.timings[m];g[m]=`${D}T${h}:00${B}`}y=g,l=E(y),localStorage.setItem("rawPrayerData",JSON.stringify(y)),localStorage.setItem("prayerCity",s.city),localStorage.setItem("prayerDate",new Date().toISOString().split("T")[0]),t.currentCity&&(t.currentCity.textContent=n),t.prayersTitle.textContent="ğŸ•‹ Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©",t.syncStatusBar.classList.remove("syncing"),t.syncStatus.innerHTML="<span>âœ“</span> <span>ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­</span>",t.lastSync.textContent=I(new Date),f.clear(),S()}catch(o){console.error("Failed to sync prayer times:",o),t.syncStatusBar.classList.remove("syncing"),t.syncStatusBar.classList.add("error"),t.syncStatus.innerHTML="<span>!</span> <span>ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.</span>"}finally{t.syncBtn.disabled=!1,setTimeout(()=>{t.syncStatusBar.classList.contains("error")&&(t.syncStatusBar.classList.remove("error"),t.syncStatus.innerHTML=`<span>âœ“</span> <span>Ù…ØªØµÙ„ - Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: <span id="lastSync">${t.lastSync.textContent}</span></span>`)},3e3)}}function F(){t.citySelect.value=s.city;for(const n in s.iqamahDurations)t.durationInputs[n].value=String(s.iqamahDurations[n]);t.settingsModal.classList.add("active")}function M(){t.settingsModal.classList.remove("active")}function R(){const n=s.city;s.city=t.citySelect.value;for(const o in s.iqamahDurations)s.iqamahDurations[o]=parseInt(t.durationInputs[o].value,10)||10;localStorage.setItem("settings",JSON.stringify(s)),M(),s.city!==n?C():(l=E(y),p(),S())}function U(){"Notification"in window&&Notification.permission==="default"&&Notification.requestPermission()}function b(n,o){"Notification"in window&&Notification.permission==="granted"&&new Notification(n,{body:o,icon:"./favicon.ico"})}async function J(){const n=localStorage.getItem("settings");if(n){const i=JSON.parse(n);s.city=i.city||"Jeddah",x[s.city]||(s.city="Jeddah"),s.iqamahDurations=i.iqamahDurations||{Fajr:25,Dhuhr:20,Asr:20,Maghrib:10,Isha:20}}if(t.citySelect.value=s.city,t.currentCity){const i=t.citySelect.options[t.citySelect.selectedIndex].text;t.currentCity.textContent=i}const o=localStorage.getItem("prayerDate"),a=new Date().toISOString().split("T")[0],r=localStorage.getItem("prayerCity"),e=localStorage.getItem("rawPrayerData");e&&o===a&&r===s.city?(y=JSON.parse(e),l=E(y),t.prayersTitle.textContent="ğŸ•‹ Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©",t.lastSync.textContent="Ø§Ù„ÙŠÙˆÙ…"):await C(),p(),S(),setInterval(S,1e3),U(),t.syncBtn.addEventListener("click",C),t.settingsBtn.addEventListener("click",F),t.closeSettingsBtn.addEventListener("click",M),t.saveSettingsBtn.addEventListener("click",R)}document.addEventListener("DOMContentLoaded",J);
